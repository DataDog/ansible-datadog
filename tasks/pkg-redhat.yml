---
- name: Copy repo file into place
  template: src=datadog.repo.j2 dest=/etc/yum.repos.d/datadog.repo owner=root group=root mode=0644

- name: Install datadog-agent package
  yum: name=datadog-agent state=latest

- name: Copy trace repo file into place
  template: src=datadog-trace.repo.j2 dest=/etc/yum.repos.d/datadog-trace.repo owner=root group=root mode=0644
  when: datadog-trace is defined and datadog-trace == True

- name: Update yum cache
  command: sudo yum makecache
  when: datadog-trace is defined and datadog-trace == True

- name: Install dd-trace package
  yum: name=dd-trace-agent state=latest
  when: datadog-trace is defined and datadog-trace == True

- name: Uninstall dd-trace package
  yum: name=dd-trace-agent state=absent
  when: datadog-trace is defined and datadog-trace == False